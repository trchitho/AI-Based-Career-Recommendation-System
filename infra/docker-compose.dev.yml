# NCKH/infra/docker-compose.dev.yml
# Compose file cho môi trường dev: backend + frontend (DB dùng từ repo setUp_DB)
version: "3.9"

services:
  backend:
    container_name: nckh-backend
    build:
      context: ../apps/backend
      dockerfile: Dockerfile
    env_file:
      - ../apps/backend/.env
    ports:
      - "8000:8000"
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ../apps/backend:/code
      - ../packages/ai-core:/code/packages/ai-core # mount ai-core nếu cần
    depends_on:
      - external_db # dummy placeholder để rõ dependency

  frontend:
    container_name: nckh-frontend
    build:
      context: ../apps/frontend
      dockerfile: Dockerfile
    env_file:
      - ../apps/frontend/.env
    ports:
      - "3000:3000"
    command: npm run dev
    volumes:
      - ../apps/frontend:/app
    depends_on:
      - backend

  # Dịch vụ “ảo” để nhắc người dùng rằng DB chạy từ repo setUp_DB
  external_db:
    image: alpine
    command:
      [
        "sh",
        "-c",
        "echo 'Database chạy riêng trong setUp_DB, port 5433' && sleep infinity",
      ]
